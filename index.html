<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SolarCurve - Estimation photovoltaïque</title>
    <link rel="stylesheet" href="styles.css" />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
    <main class="container">
      <header>
        <h1>SolarCurve</h1>
        <p>Estimation de la production photovoltaïque quotidienne sur l'année.</p>
      </header>

      <section class="card">
        <form id="pv-form" class="form-grid">
          <label>
            Latitude
            <input id="lat" name="lat" type="text" inputmode="decimal" pattern="^-?\d{1,2}(?:[.,]\d{1,6})?$" required placeholder="ex: 42.7" />
          </label>

          <label>
            Longitude
            <input id="lon" name="lon" type="text" inputmode="decimal" pattern="^-?\d{1,3}(?:[.,]\d{1,6})?$" required placeholder="ex: 9.45" />
          </label>

          <label>
            Puissance (Wc)
            <input id="peakPower" name="peakPower" type="number" step="1" min="1" value="1000" required />
          </label>

          <label>
            Inclinaison (°)
            <input id="tilt" name="tilt" type="number" min="0" max="90" value="30" required />
          </label>

          <label>
            Azimut (°)
            <input id="azimuth" name="azimuth" type="number" min="-180" max="180" value="0" required />
            <small>Convention app : 0=sud, -90=est, +90=ouest</small>
          </label>

          <label class="check-label">
            <input id="compareAzimuth" name="compareAzimuth" type="checkbox" />
            Ajouter un 2e azimut
          </label>

          <label id="azimuth2-wrapper" class="hidden">
            Azimut 2 (°)
            <input id="azimuth2" name="azimuth2" type="number" min="-180" max="180" value="90" disabled />
            <small>Courbe superposée</small>
          </label>

          <label>
            Pertes (%)
            <input id="losses" name="losses" type="number" min="0" max="100" step="0.1" value="14" required />
          </label>

          <label>
            API source
            <select id="source" name="source">
              <option value="pvgis" selected>PVGIS (recommandé Europe/Corse)</option>
              <option value="pvwatts">PVWatts (NREL)</option>
            </select>
          </label>

          <label id="pvwatts-key-wrapper" class="hidden">
            Clé API PVWatts
            <input id="pvwattsKey" name="pvwattsKey" type="text" placeholder="Votre clé NREL" />
          </label>

          <div class="actions">
            <button id="geo-btn" type="button">Utiliser ma position</button>
            <button id="estimate-btn" type="submit">Estimer la production</button>
          </div>
        </form>

        <h2 class="chart-title">Carte (cliquer pour choisir le point GPS)</h2>
        <div id="map" class="map"></div>
        <p id="mapHint" class="map-hint">
          Aucun point sélectionné sur la carte. (Ctrl+clic pour ajuster l'azimut)
        </p>
      </section>

      <section class="card">
        <div id="status" class="status">Prêt.</div>
        <div id="stats" class="stats hidden"></div>

        <h2 class="chart-title">Profil mensuel moyen (heure par heure)</h2>
        <div class="month-row hidden">
          <label for="monthSelect">Mois</label>
          <select id="monthSelect">
            <option value="1">Janvier</option>
            <option value="2">Février</option>
            <option value="3">Mars</option>
            <option value="4">Avril</option>
            <option value="5">Mai</option>
            <option value="6" selected>Juin</option>
            <option value="7">Juillet</option>
            <option value="8">Août</option>
            <option value="9">Septembre</option>
            <option value="10">Octobre</option>
            <option value="11">Novembre</option>
            <option value="12">Décembre</option>
          </select>
        </div>
        <div class="chart-container hidden">
          <canvas id="monthlyProfileChart"></canvas>
        </div>

        <h2 class="chart-title">Profil journalier (heure par heure, 1 jour à la fois)</h2>
        <div class="slider-row hidden">
          <label for="daySlider">Jour</label>
          <input id="daySlider" type="range" min="1" max="365" step="1" value="1" disabled />
          <span id="dayLabel">-</span>
        </div>
        <div class="day-arrow-row hidden">
          <button id="prevDay" class="small-btn" title="Jour précédent">◀</button>
          <button id="nextDay" class="small-btn" title="Jour suivant">▶</button>
        </div>
        <div class="chart-container hidden">
          <canvas id="dailyProfileChart"></canvas>
        </div>
      </section>
    </main>

    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin=""
    ></script>
    <script src="app.js"></script>
  </body>
</html>
